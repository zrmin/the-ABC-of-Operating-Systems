<h1><center>一、操作系统概述</center></h1>

1.1 操作系统的概念、特征、功能和服务

1.1.1 操作系统概念

OS是系统软件，程序模块的集合，资源管理和用户接口功能



操作系统的目标（不同视角）：

* 方便性（用户的观点）

提供良好的、一致的用户接口，弥补硬件系统的类型和数量差别，使计算机更容易使用

* 有效性（系统管理人员的观点）

使CPU、I/O设备和存储空间得到有效利用；管理和分配软、硬件资源，合理地组织计算机的工作流程

* 可扩充性

OS应采用层次化结构，以便于增加新的功能层次和模块，并能修改老的功能层次和模块

* 开放性

遵循标准规范，方便地实现互联，实现应用的可移植性和互操作性



1. OS作为用户与计算机硬件系统间的接口

* OS处于用户与计算机硬件系统之间，用户通过OS来使用计算机系统
* 系统方式（命令接口）
  * 命令行
  * 菜单式
  * 命令脚本式
* 系统调用（程序接口）
  * 形式上类似于过程调用
  * 在应用编程中使用
* 图形用户接口
  * 图形、窗口等

2. OS作为计算机系统资源的管理者

* 计算机的硬件资源包括处理机、存储器、I/O设备及数据和程序等
* 管理的内容：资源的当前状态（数量和使用情况）、资源的分配、回收和访问操作，相应的管理策略（包括用户权限）
  * CPU管理
  * 存储器管理
  * I/O设备管理
  * 文件管理

3. OS用作扩充机器

* OS是扩展机（extended machine）/虚拟机（virtual machine）
  * 将覆盖了软件的机器成为扩展机或虚拟机
* 在裸机上添加：设别管理、文件管理、存储管理（针对内存和外存）、CPU管理
* 合理组织工作流程：作业管理、进程管理

<font color = red>操作系统的非形式化定义（关键点）：系统软件，程序模块的集合，资源管理和用户接口功能</font>



1.1.2 操作系统的基本特征

* 并发性（Concurrence）
* 共享（Sharing）
* 虚拟（Virtual）
* 异步性（Asynchronism）

（注意：这里指的是通用操作系统）

并发：

* 并发指的是多个事件在<font color=blue>同一时间段内</font>发生。操作系统是一个并发系统，各进程间的并发，系统与应用间的并发。操作系统要完成这些并发过程的管理
* 并行parallel是指在<font color=blue>同一时刻</font>发生
* 在多道程序处理时，宏观上并发，微观上交替执行（在单处理器情况下）
* 程序的静态实体是可执行文件，而动态实体是进程（或称作任务），并发指的是进程（或线程）

（注意：区分并发和并行）

共享：

* 是指系统中的资源可供内存中多个并发执行的进程（线程）共同使用。因资源属性不同，对资源共享的方式也不同
* 互斥共享（如音频设备、打印机等）
  * 资源分配后释放前，不能被其他进程所用
* 同时访问（如可重入代码，磁盘文件）
  * 同时是宏观上，在微观上进程可能是交替地对资源进行访问

（注意：并发和共享是相互依存的）

* 并发和共享是操作系统的两个最基本的特征
  * 一方面，资源共享是以程序（进程）的并发执行为条件的
  * 另一方面，若系统不能对资源共享实施有效管理，协调好诸进程对共享资源的访问，也必然影响到程序并发执行的程度

虚拟性：

* 通过某种技术把一个物理实体变为若干个逻辑上的对应物，提高资源的利用率
  * CPU——每个用户（进程）的“虚处理机”——PCB
  * 存储器——每个进程都占有的地址空间（指令+数据+堆栈）
  * 显示设备——多窗口或虚拟终端（virtual terminal）
  * 打印设备——将临界资源变为同时访问资源

异步性：

* 不确定性：进程的执行顺序和执行时间的不确定性
  * 进程的运行速度不可预知：分时系统中，多个进程并发执行，“时走时停”，不可预知每个进程的运行推进快慢
* 判据：无论快慢，应该结果相同——通过进程互斥和同步手段来保证
  * 难以重现系统在某个时刻的状态（包括重现运行中的错误）
* 性能保证：实时系统与分时系统相似，但通过资源预留以保证性能



1.1.3 操作系统的主要功能

* CPU管理
* 存储器管理
* 设备管理
* 文件管理
* 用户管理



CPU管理

* 完成CPU资源的分配、回收调度等功能
* CPU调度的单位可为进程或线程
* 进程控制
  * 创建、撤销、挂起、改变运行优先级等
* 进程同步
  * 协调并发进程之间的推进步骤，以协调资源共享
  * 互斥方式，诸进程访问临界资源时采用这种方式
  * 同步方式，在相互合作完成任务的进程之间由同步机构对执行次序加以协调

* 进程通信
  * 负责进程之间传送数据，以协调进程间的协作
  * 如，输入进程、计算进程、打印进程之间的通信
* 进程调度
  * 作业和进程的运行切换，以充分利用CPU资源和提高系统性能
  * 作业调度从外存调入内存
  * 进程协调是从内存中的进程就绪队列中选一个分配CPU
  * 在多线程OS中，要考虑线程调度
  * 考虑同一类型内的公平性、高效率（吞吐量大）、作业或进程的周转时间等

存储器管理

* 管理目标
  * 提高利用率、方便用户使用、提供足够大的存储空间、方便进程并发执行
* 内存分配
  * 为每道程序分配空间：静态分配、动态分配
  * 提高利用率
  * 允许正在运行程序申请附加空间
* 内存保护
  * 确保每道用户程序都只在自己的内存空间内运行、互不干扰
  * 如：访问合法性检查、甚至要防止从“垃圾”中窃取其他进程的信息
  * 一种方法是设置两个界限寄存器，由硬件实现越界检查
* 地址映射
  * 程序中的地址成为“逻辑地址”或“相对地址”
  * 内存中单元的地址成为“物理地址”
  * 多道程序下，进程装入内存后要由逻辑地址到内存物理地址进行变换
* 内存扩充
  * 借助于虚拟存储技术，从逻辑上去扩充内存容量
  * 改善了系统的性能，基本上不增加硬件投资
  * 请求调入功能
  * 置换功能

设备管理

* 管理目标
  * 方便的设备使用、提高CPU与I/O设备利用率、提高I/O速度
* 缓冲区管理
  * 匹配CPU和外设的速度，提高两者的利用率
  * 单缓冲、双缓冲、公共缓冲池
* 设备分配与回收
  * 在多用户间共享I/O设备资源
  * 针对不同类型设备采用不同策略，如独占设备分配
  * 虚拟设备（virtual device）：设备由多个进程共享，每个进程如同独占
* 设备独立性
  * 用户申请的设备与实际操作的物理设备无关

文件管理

* 管理目标
  * 对用户文件和系统文件进行管理，以方便用户使用并保证文件安全
* 文件存储空间管理里
  * 解决如何存放信息，以提高空间利用率和读写性能
  * 存储空间的使用情况，空间分配与回收
* 目录管理
  * 解决信息检索问题，能按名存取
  * 目录项包括文件名、文件属性、文件在磁盘上的物理位置等
* 文件读写
  * 根据用户请求，从外存中读取数据；或将数据写入外存
* 文件保护
  * 解决信息安全问题
  * 防止未经核准的用户存取文件
  * 防止冒名顶替存取文件
  * 防止以不正确的方式使用文件

用户接口

* 目标
  * 提供一个友好的用户访问操作系统的接口
* 命令接口
  * 联机用户接口 这是为联机用户提供的，它由一组键盘操作命令及命令解释程序所组成
  * 脱机用户接口 该接口是为批处理作业的用户提供的，故也称为批处理用户接口。该接口由一组作业控制语言JCL组成
* 程序接口
  * 该接口是为用户程序在执行中访问系统资源而设置的，是用户程序取得操作系统服务的唯一途径。它是由一组系统调用组成，每一个系统调用都是一个能完成特定功能的子程序
* 图形接口
  * 图形用户接口采用了图形化的操作界面，用非常容易识别的各种图标（icon）来将系统的各项功能、各种应用程序和文件，直观、逼真地表示出来



1.2 操作系统地发展与分类

1..2.1 操作系统的发展过程

* 无操作系统的计算机系统
* 单道批处理系统
* 多道批处理系统
* 分时系统
* 实时系统
* 网络操作系统
* 分布式操作系统
* 嵌入式操作系统

人工操作方式

* 1946~50年代（电子管），集中计算（计算中心），计算机资源昂贵

* 工作方式

  * 用户：用户既是程序员，又是操作员；用户是计算机专业人员
  * 编程语言：机器语言
  * 输入输出：纸带或卡片

* 计算机的工作特点

  * 用户独占全机：不出现资源被其他用户占用，资源利用率低
  * CPU等待用户：计算前，手工装入纸带或卡片；计算完成后，手工卸取纸带或卡片；CPU利用率低

  <font color=red>严重降低了计算机资源的利用率——人机矛盾</font>

硬件不断发展，CPU速度提高、系统规模扩大，人机矛盾严重，如何解决？

脱机输入/输出（Off-Line I/O）方式

* 事先将用户程序或数据的纸带或卡片输入纸带输入机，在外围机的控制下输入到磁带上，CPU从磁带上读入数据；输出过程正好相反
* 特点：
  * 减少CPU的空闲时间
  * 提高I/O速度

无操作系统的主要问题：

* 主要矛盾
  * 计算机处理能力的提高，手工操作的低效率（造成浪费）
  * 用户独占全机的所有资源
* 提高效率的途径
  * 专门的操作员
  * 批处理

单道批处理系统（Simple Batch Processing System）

* 50年代末~60年代中（晶体管）：利用磁带把若干个作业分类编成作业执行序列，每个批作业由一个专门的监督程序（Monitor）自动依次处理。可使用汇编语言开发
* 批处理中的作业的组成
  * 用户程序
  * 数据
  * 作业说明书（作业控制语言）
* 批
  * 供一次加载的磁带或磁盘，通常由若干个作业组装成，在处理中使用一组相同的系统软件（系统带）

两种批处理方式——联机批处理

* 用户提交作业：以纸带或卡片为介质
* 操作员合成批作业：结果为磁带介质
* 批作业处理：对批作业中的每个作业进行相同的处理：从磁带读入用户作业和编译链接程序，编译链接用户作业，生成可执行程序；启动执行；执行结果输出
* 问题：慢速的输入输出处理仍直接由主机来完成。输入输出时，CPU处于等待状态

两种批处理方式——脱机批处理

* 卫星机：完成面向用户的输入输出（纸带或卡片），中间结果暂存在磁带或磁盘上
* 卫星机完成输入输出功能。主机与卫星机可并行工作
* 作业控制命令由监督程序（monitor）来执行，完成如装入程序、编译、运行等操作
* 优点：同一批内各作业的自动依次更替，改善了主机CPU和I/O设备的使用效率，提高了吞吐量
* 缺点：磁带或磁盘需要人工装卸，作业需要人工分类，监督程序易遭到用户程序的破坏（由人工干预才可恢复）

单道批处理系统的特征

* 自动性
  * 在顺利的情况下，磁带上的一批作业能自动地逐个地依次运行，而无需人工干预
* 顺序性
  * 磁带上的各道作业是顺序地进入内存，完成顺序与进入内存顺序相同
* 单道性
  * 内存中只有一道程序运行
* CPU和I/O设备忙闲不均（取决于当前作业）
  * 对计算为主的作业，外设空闲
  * 对I/O为主的作业，CPU空闲

多道批处理系统（Multiprogramed Batch System）

CPU、I/O设备忙闲不均、内存利用率低，如何解决？

* 60年代~70年代中（集成电路），利用多道批处理提高资源的利用率——现代操作系统的雏形
* 多道批处理的运行特征
  * 多道：内存中同时存放几个作业，并允许并发执行，从而有效地提高了资源利用率和系统吞吐量
  * 无序性：多个作业完成的先后顺序与它们进入内存的顺序之间无严格对应关系
  * 调度性：作业调度，从后备队列进入内存；进程调度，分配CPU运行
* 举例
  * 在当前运行的作业需作I/O处理时，CPU转而执行另一个作业

多道批处理系统的特征

* 多道性
  * 多道程序驻留内存：提高了资源的利用率
  * 程序并发执行：提高了系统的吞吐量
* 无序性
  * 作业进入内存先后顺序和完成的先后顺序无对应性
* 调度性
  * 作业提交给系统需经过两次调度
  * 作业调度
  * 进程调度

|          |      单道      |             多道             |
| :------: | :------------: | :--------------------------: |
| 内存使用 |  每次一个作业  | 每次多个作业（充分利用内存） |
| 作业次序 | 顺序，先进先出 |          无确定次序          |

|                                      | 单道批处理 | 多道批处理 |
| :----------------------------------: | :--------: | :--------: |
|          内存中驻留程序数目          |    一道    |    多道    |
|            占用CPU的情况             |    独占    |  交替占用  |
|        是否需要作业和进程调度        |   不需要   |    需要    |
| 程序完成次序与其进入内存次序间的关系 |  严格对应  | 不严格对应 |

多道批处理系统的特点

* 优点
  * 资源利用率高：CPU、I/O设备和内存利用率较高
  * 作业吞吐量大：单位时间内完成的工作总量大
* 缺点
  * 用户交互性差：整个作业完成后或中间出错时，才与用户交互，不利于调试和修改
  * 作业平均周转时间成：短作业的周转时间显著增长

